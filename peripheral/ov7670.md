# ov7670 카메라 모듈에 대해 다룹니다. 

## zybo z7 20 기준. 자세한 코드는 참고파일 확인 바람. 여기서는 타이밍에 관한 문제를 다룹니다.

## 핀 매핑에 따른 타이밍 문제.

xdc에서 핀 매핑만 바꿔도 타이밍 문제가 어느 정도 해결될 수 있다.

다음과 같은 경우를 보자.

```
##Buttons
set_property -dict { PACKAGE_PIN K18   IOSTANDARD LVCMOS33 } [get_ports { btnl }]; #IO_L12N_T1_MRCC_35 Sch=btn[0]
set_property -dict { PACKAGE_PIN P16   IOSTANDARD LVCMOS33 } [get_ports { btnc }]; #IO_L24N_T3_34 Sch=btn[1]
#set_property -dict { PACKAGE_PIN K19   IOSTANDARD LVCMOS33 } [get_ports { btnr }]; #IO_L10P_T1_AD11P_35 Sch=btn[2]
#set_property -dict { PACKAGE_PIN Y16   IOSTANDARD LVCMOS33 } [get_ports { btn[3] }]; #IO_L7P_T1_34 Sch=btn[3]


##LEDs
set_property -dict { PACKAGE_PIN M14   IOSTANDARD LVCMOS33 } [get_ports { config_finished }]; #IO_L23P_T3_35 Sch=led[0]
#set_property -dict { PACKAGE_PIN M15   IOSTANDARD LVCMOS33 } [get_ports { led[1] }]; #IO_L23N_T3_35 Sch=led[1]
#set_property -dict { PACKAGE_PIN G14   IOSTANDARD LVCMOS33 } [get_ports { led[2] }]; #IO_0_35 Sch=led[2]
#set_property -dict { PACKAGE_PIN D18   IOSTANDARD LVCMOS33 } [get_ports { led[3] }]; #IO_L3N_T0_DQS_AD1N_35 Sch=led[3]
```

이 때 타이밍은 다음과 같다.

<img width="580" height="191" alt="image" src="https://github.com/user-attachments/assets/0b740b7b-89f4-4fda-b196-41d08de82fd6" /> <img width="579" height="193" alt="image" src="https://github.com/user-attachments/assets/21357f6f-01ae-4bd8-905a-0c81b043ca1a" /> <img width="575" height="197" alt="image" src="https://github.com/user-attachments/assets/edfa82da-3eb6-4442-bb92-6dd1b1c42cf5" />

그리고 htmi 출력은 다음과 같이 된다. 

![20251222_134645](https://github.com/user-attachments/assets/ec961832-39a9-4c56-a179-9deb95027202)


다음과 같은 경우를 보자.

```
##Switches
set_property -dict { PACKAGE_PIN G15   IOSTANDARD LVCMOS33 } [get_ports { btnr }]; #IO_L19N_T3_VREF_35 Sch=sw[0]
set_property -dict { PACKAGE_PIN P15   IOSTANDARD LVCMOS33 } [get_ports { btnl }]; #IO_L24P_T3_34 Sch=sw[1]
#set_property -dict { PACKAGE_PIN W13   IOSTANDARD LVCMOS33 } [get_ports { sw[2] }]; #IO_L4N_T0_34 Sch=sw[2]
#set_property -dict { PACKAGE_PIN T16   IOSTANDARD LVCMOS33 } [get_ports { btnl }]; #IO_L9P_T1_DQS_34 Sch=sw[3]


##Buttons
#set_property -dict { PACKAGE_PIN K18   IOSTANDARD LVCMOS33 } [get_ports { btnl }]; #IO_L12N_T1_MRCC_35 Sch=btn[0]
set_property -dict { PACKAGE_PIN P16   IOSTANDARD LVCMOS33 } [get_ports { btnc }]; #IO_L24N_T3_34 Sch=btn[1]
#set_property -dict { PACKAGE_PIN K19   IOSTANDARD LVCMOS33 } [get_ports { btnr }]; #IO_L10P_T1_AD11P_35 Sch=btn[2]
#set_property -dict { PACKAGE_PIN Y16   IOSTANDARD LVCMOS33 } [get_ports { btn[3] }]; #IO_L7P_T1_34 Sch=btn[3]
```

이 때 타이밍은 다음과 같다.

<img width="587" height="188" alt="image" src="https://github.com/user-attachments/assets/362db05c-4057-45b0-bde2-d04bf2c5d580" /> <img width="586" height="200" alt="image" src="https://github.com/user-attachments/assets/a6e5fcd4-a355-4e56-a6c2-bde914137cc4" /> <img width="591" height="196" alt="image" src="https://github.com/user-attachments/assets/bc7aafda-34a3-4072-b4c9-36ce6164a8d2" />

그리고 htmi 출력은 다음과 같이 된다.

<img width="2959" height="2020" alt="20251222_135124" src="https://github.com/user-attachments/assets/a5d3815b-07b8-4eae-8d25-7be0eeea3f37" />


다음과 같은 경우를 보자.

```
##Switches
set_property -dict { PACKAGE_PIN G15   IOSTANDARD LVCMOS33 } [get_ports { btnr }]; #IO_L19N_T3_VREF_35 Sch=sw[0]
#set_property -dict { PACKAGE_PIN P15   IOSTANDARD LVCMOS33 } [get_ports { btnl }]; #IO_L24P_T3_34 Sch=sw[1]
#set_property -dict { PACKAGE_PIN W13   IOSTANDARD LVCMOS33 } [get_ports { sw[2] }]; #IO_L4N_T0_34 Sch=sw[2]
set_property -dict { PACKAGE_PIN T16   IOSTANDARD LVCMOS33 } [get_ports { btnl }]; #IO_L9P_T1_DQS_34 Sch=sw[3]


##Buttons
#set_property -dict { PACKAGE_PIN K18   IOSTANDARD LVCMOS33 } [get_ports { btnl }]; #IO_L12N_T1_MRCC_35 Sch=btn[0]
set_property -dict { PACKAGE_PIN P16   IOSTANDARD LVCMOS33 } [get_ports { btnc }]; #IO_L24N_T3_34 Sch=btn[1]
#set_property -dict { PACKAGE_PIN K19   IOSTANDARD LVCMOS33 } [get_ports { btnr }]; #IO_L10P_T1_AD11P_35 Sch=btn[2]
#set_property -dict { PACKAGE_PIN Y16   IOSTANDARD LVCMOS33 } [get_ports { btn[3] }]; #IO_L7P_T1_34 Sch=btn[3]
```

이 때 타이밍은 다음과 같다.

<img width="579" height="180" alt="image" src="https://github.com/user-attachments/assets/db76f35f-581f-4165-bcd7-16422ce36f9d" /> <img width="586" height="187" alt="image" src="https://github.com/user-attachments/assets/4ef9f4a1-2b19-45b9-ba9a-3cb83aa7fe55" /> <img width="585" height="199" alt="image" src="https://github.com/user-attachments/assets/eb708436-c168-4b26-94e4-cd38456db7d9" />

그리고 htmi 출력은 다음과 같이 된다.

<img width="2955" height="2365" alt="20251222_135610" src="https://github.com/user-attachments/assets/757ec585-99db-446b-be9e-9dbca95c359f" />

## 결론

### 타이밍이 위반이거나, 위반이 아니어도 매우 작은 값이면 노이즈가 생길 수 있다.<br><br>또한, 타이밍은 핀 매핑에 따라서 바뀔 수도 있다. 코드에 문제가 없다면 핀 매핑을 바꿔보는 것도 하나의 타이밍 제어 방법이 될 수 있다. 
